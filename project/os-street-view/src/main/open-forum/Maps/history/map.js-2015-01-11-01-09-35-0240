var canvas;

var offsetX = 0;
var offsetY = 0;

var imageWidth = 5004;
var imageHeight = 5004;

var locationX = 600000;
var locationY = 700000;

var lastMapX = 0;
var lastMapY = 0;

var status;

function initMap() {
  canvas =new Canvas("mapCanvas");
  
  Giraffe.Interactive.setInteractive(canvas);
  
  canvas.add( new Rectangle(0,0,screenWidth,screenHeight).setFillColor("#003300") );
  
  Giraffe.setAnimated(canvas);
  canvas.startAnimation(20,100,true);
  
  //offsetX = (screenWidth/2)-imageWidth;
  //offsetY = (screenHeight/2)-imageHeight;
  
  offsetX = -(imageWidth/2);//-imageWidth;
  offsetY = -(imageHeight/2);//-imageHeight;
  
  createMap();
  
  updateTiles();
  
  canvas.add(map);
  canvas.makeDraggable(map);
  
  map.animate = function(frame) {
    
/*    if(map.x!==lastMapX) {
      var dx = map.x-lastMapX;
      locationX += dx;
      lastMapX = map.x;
      updateTiles();
    }
    if(map.y!==lastMapY) {
      var dy = map.y-lastMapY;
      locationY += dy;
      lastMapY = map.y;
      updateTiles();
    }
    
    if(map.x<-imageWidth || map.x>imageWidth) {
      map.x = 0;
      lastMapX = 0;
    }
    
    if(map.y<-imageHeight || map.y>imageHeight) {
      map.y = 0;
      lastMapY = 0;
    }*/
    
  };
  
  canvas.add( new Rectangle(5,5,800,35).setFillColor("white").setColor("black") );
  state = new Text(30,30,"Status: ",25,"Arial").setFillColor("#0000cc");
  state.animate = function(frame) {
    state.text = "X:"+map.x+" Y:"+map.y+" LX:"+locationX+" LY:"+locationY;
  };
  
  canvas.add( state );
}

function createMap() {
  tile1 = new Picture(	offsetX-imageWidth,     offsetY-imageHeight,  "/Maps/OSStreetView/blank.png");
  tile2 = new Picture(	offsetX,                         offsetY-imageHeight,  "/Maps/OSStreetView/blank.png");
  tile3 = new Picture(	offsetX+imageWidth,    offsetY-imageHeight,  "/Maps/OSStreetView/blank.png");
  
  
  tile4 = new Picture(	offsetX-imageWidth,     offsetY,                       "/Maps/OSStreetView/blank.png");
  tile5 = new Picture(	offsetX,                         offsetY,                       "/Maps/OSStreetView/blank.png");
  tile6 = new Picture(	offsetX+imageWidth,    offsetY,                       "/Maps/OSStreetView/blank.png");
  
  tile7 = new Picture(	offsetX-imageWidth,     offsetY+imageHeight, "/Maps/OSStreetView/blank.png");
  tile8 = new Picture(	offsetX,                         offsetY+imageHeight, "/Maps/OSStreetView/blank.png");
  tile9 = new Picture(	offsetX+imageWidth,    offsetY+imageHeight, "/Maps/OSStreetView/blank.png");
  
  map = new Composite(0,0);
  map.add(tile1);
  map.add(tile2);
  map.add(tile3);
  map.add(tile4);
  map.add(tile5);
  map.add(tile6);
  map.add(tile7);
  map.add(tile8);
  map.add(tile9);
}

function updateTiles() {
  var tileSource = OSMap.getTile(  locationX-imageWidth,  locationY-imageHeight);
  tile1.img.src = "/Maps/OSStreetView/NorfolkStreetView/" + tileSource;
   tileSource = OSMap.getTile(  locationX,                           locationY-imageHeight);
  tile2.img.src = "/Maps/OSStreetView/NorfolkStreetView/" + tileSource;
   tileSource = OSMap.getTile(  locationX+imageWidth,      locationY-imageHeight);
  tile3.img.src = "/Maps/OSStreetView/NorfolkStreetView/" + tileSource;
  
   tileSource = OSMap.getTile(  locationX-imageWidth,       locationY);
  tile4.img.src = "/Maps/OSStreetView/NorfolkStreetView/" + tileSource;
   tileSource = OSMap.getTile(  locationX,                           locationY);
  tile5.img.src = "/Maps/OSStreetView/NorfolkStreetView/" + tileSource;
   tileSource = OSMap.getTile(  locationX+imageWidth,      locationY);
  console.log(tileSource);
  tile6.img.src = "/Maps/OSStreetView/NorfolkStreetView/" + tileSource;
  
   tileSource = OSMap.getTile(  locationX-imageWidth,       locationY+imageHeight);
  tile7.img.src = "/Maps/OSStreetView/NorfolkStreetView/" + tileSource;
   tileSource = OSMap.getTile(  locationX,                           locationY+imageHeight);
  tile8.img.src = "/Maps/OSStreetView/NorfolkStreetView/" + tileSource;
   tileSource = OSMap.getTile(  locationX+imageWidth,      locationY+imageHeight);
  tile9.img.src = "/Maps/OSStreetView/NorfolkStreetView/" + tileSource;
}


